import { createI18n } from "vue-i18n";

import { useAppStore } from "@/store/app";

const messages = {
  zh: {
    menu: {
      updates: "首页",
      manage: "管理",
      bastions: "跳板机",
      mappings: "映射",
      logs: "日志",
      httpLogs: "HTTP 日志",
      errorLogs: "错误日志",
    },
    actions: {
      refresh: "刷新",
      shutdown: "关闭服务",
      language: "语言",
    },
    menuToggle: "展开/收起侧边栏",
    toast: {
      shutdownInitiated: "已发起关闭",
      updateStarted: "已开始更新",
      themeDark: "已切换为暗黑",
      themeLight: "已切换为浅色",
      languageSwitchedToZh: "已切换为中文",
      languageSwitchedToEn: "已切换为英文",
    },
    apiError: {
      INVALID_REQUEST: "请求参数错误",
      NOT_FOUND: "资源不存在",
      CONFLICT: "资源冲突",
      RESOURCE_BUSY: "资源忙（端口占用）",
      RESOURCE_BUSY_ADDR: "资源忙（端口占用）：{addr}",
      RESOURCE_BUSY_OWNER_ADDR: "资源忙（端口占用）：{addr}（PID {pid}，{exe}）",
      RESOURCE_BUSY_PID_ADDR: "资源忙（端口占用）：{addr}（PID {pid}）",
      RESOURCE_BUSY_OWNER: "资源忙（端口占用）：PID {pid}，{exe}",
      RESOURCE_BUSY_PID: "资源忙（端口占用）：PID {pid}",
      BAD_GATEWAY: "网关错误",
      INTERNAL_ERROR: "服务器内部错误",
      NETWORK: "网络异常",
      TIMEOUT: "请求超时",
      UNKNOWN: "请求失败",
    },

    common: {
      add: "新增",
      edit: "编辑",
      copy: "复制",
      delete: "删除",
      confirm: "确认",
      cancel: "取消",
      close: "关闭",
      save: "保存",
      clear: "清空",
      search: "搜索",
      reset: "重置",
      detail: "详情",
      loading: "加载中…",
      optional: "（可选）",
      yes: "是",
      no: "否",
      on: "开",
      off: "关",
    },
    theme: {
      light: "浅色",
      dark: "暗黑",
    },
    table: {
      id: "ID",
      time: "时间",
      actions: "操作",
    },
    validation: {
      required: "{field}为必填项",
      tcpRemoteRequired: "TCP 模式需要填写远端主机和端口",
    },
    confirmDialog: {
      code: "确认码",
      countdown: "倒计时",
      input: "输入 6 位确认码",
      generate: "生成确认码",
      submit: "提交确认码",
      expired: "确认码已过期，请重新生成。",
    },
    home: {
      title: "更新",
      statusCard: "更新状态",
      checkUpdate: "检查更新",
      confirmUpdate: "确认更新",
      currentVersion: "当前版本",
      latestVersion: "最新版本",
      status: "状态",
      upToDate: "已是最新",
      updateAvailable: "有可用更新",
      unknown: "未知",
      helperLogPath: "更新助手日志路径",
      proxy: "代理设置",
      proxyDetails: "详细信息",
      proxyEnv: "系统环境变量",
      proxyManual: "手动设置",
      manualProxySaved: "服务端手动代理",
      effectiveRule: "生效规则",
      sourceManual: "手动（优先）",
      sourceEnv: "环境变量",
      sourceNone: "未使用",
      sourceHintManual: "使用服务端保存的手动代理",
      sourceHintEnv: "使用环境变量 HTTP_PROXY/HTTPS_PROXY/ALL_PROXY",
      sourceHintNone: "请求不使用代理",
      detectedProxy: "检测到的代理（只读）",
      manualProxy: "手动代理（持久化）",
      effectiveProxy: "生效代理",
      source: "来源",
    },
    bastions: {
      title: "跳板机",
      name: "名称",
      host: "主机",
      port: "端口",
      username: "用户名",
      password: "密码",
      pkeyPath: "私钥路径",
      pkeyPassphrase: "私钥口令",
    },
    mappings: {
      title: "映射",
      types: {
        tcp: "TCP",
        socks5: "SOCKS5",
        http: "HTTP",
        mixed: "混合(HTTP+SOCKS5)",
      },
      localHost: "本地主机",
      localPort: "本地端口",
      remoteHost: "远端主机",
      remotePort: "远端端口",
      id: "ID",
      type: "类型",
      local: "本地",
      remote: "远端",
      chain: "跳板链",
      allowCidrs: "允许 CIDR",
      denyCidrs: "拒绝 CIDR",
      autoStart: "自启",
      running: "运行中",
      start: "启动",
      stop: "停止",
      copyModify: "复制修改",
      trafficChart: "流量图",
      trafficUp: "上行",
      trafficDown: "下行",
      trafficConnections: "连接数",
    },
    httpLogs: {
      title: "HTTP 日志",
      columns: {
        mapping: "映射",
        port: "端口",
        method: "方法",
        status: "状态码",
        host: "Host",
        url: "URL",
        duration: "耗时(ms)",
      },
      q: "关键字",
      request: "请求",
      response: "响应",
      pair: "请求/响应",
      headers: "Headers",
      body: "Body",
      decodeGzip: "解压 gzip（仅响应 Body）",
      truncated: "内容被截断：{reason}",
    },
    errorLogs: {
      title: "错误日志",
      level: "级别",
      source: "来源",
      message: "消息",
      detail: "详情",
      stack: "堆栈",
      context: "上下文",
    },
    dialogs: {
      shutdownTitle: "关闭服务确认",
      shutdownAlert: "此操作会关闭 Bastion 服务进程，请确认。",
      updateTitle: "应用更新确认",
      updateAlert: "此操作会下载并替换当前可执行文件，然后重启。",
      deleteTitle: "确认删除？",
    },
  },
  en: {
    menu: {
      updates: "Updates",
      manage: "Manage",
      bastions: "Bastions",
      mappings: "Mappings",
      logs: "Logs",
      httpLogs: "HTTP Logs",
      errorLogs: "Error Logs",
    },
    actions: {
      refresh: "Refresh",
      shutdown: "Shutdown",
      language: "Language",
    },
    menuToggle: "Toggle sidebar",
    toast: {
      shutdownInitiated: "Shutdown initiated",
      updateStarted: "Update started",
      themeDark: "Switched to dark",
      themeLight: "Switched to light",
      languageSwitchedToZh: "Switched to Chinese",
      languageSwitchedToEn: "Switched to English",
    },
    apiError: {
      INVALID_REQUEST: "Invalid request",
      NOT_FOUND: "Not found",
      CONFLICT: "Conflict",
      RESOURCE_BUSY: "Resource busy (port in use)",
      RESOURCE_BUSY_ADDR: "Resource busy (port in use): {addr}",
      RESOURCE_BUSY_OWNER_ADDR: "Resource busy (port in use): {addr} (PID {pid}, {exe})",
      RESOURCE_BUSY_PID_ADDR: "Resource busy (port in use): {addr} (PID {pid})",
      RESOURCE_BUSY_OWNER: "Resource busy (port in use): PID {pid}, {exe}",
      RESOURCE_BUSY_PID: "Resource busy (port in use): PID {pid}",
      BAD_GATEWAY: "Bad gateway",
      INTERNAL_ERROR: "Internal server error",
      NETWORK: "Network error",
      TIMEOUT: "Request timeout",
      UNKNOWN: "Request failed",
    },

    common: {
      add: "Add",
      edit: "Edit",
      copy: "Copy",
      delete: "Delete",
      confirm: "Confirm",
      cancel: "Cancel",
      close: "Close",
      save: "Save",
      clear: "Clear",
      search: "Search",
      reset: "Reset",
      detail: "Detail",
      loading: "Loading…",
      optional: "(optional)",
      yes: "Yes",
      no: "No",
      on: "On",
      off: "Off",
    },
    theme: {
      light: "Light",
      dark: "Dark",
    },
    table: {
      id: "ID",
      time: "Time",
      actions: "Actions",
    },
    validation: {
      required: "{field} is required",
      tcpRemoteRequired: "TCP requires remote_host and remote_port",
    },
    confirmDialog: {
      code: "Code",
      countdown: "Countdown",
      input: "Enter 6-digit code",
      generate: "Generate Code",
      submit: "Submit Code",
      expired: "Code expired, please generate again.",
    },
    home: {
      title: "Updates",
      statusCard: "Update status",
      checkUpdate: "Check Update",
      confirmUpdate: "Confirm Update",
      currentVersion: "Current version",
      latestVersion: "Latest version",
      status: "Status",
      upToDate: "Up to date",
      updateAvailable: "Update available",
      unknown: "Unknown",
      helperLogPath: "Update helper log path",
      proxy: "Proxy settings",
      proxyDetails: "Details",
      proxyEnv: "System env",
      proxyManual: "Manual",
      manualProxySaved: "Server manual proxy",
      effectiveRule: "Effective rule",
      sourceManual: "Manual (preferred)",
      sourceEnv: "Environment",
      sourceNone: "None",
      sourceHintManual: "Uses the server saved manual proxy",
      sourceHintEnv: "Uses HTTP_PROXY/HTTPS_PROXY/ALL_PROXY",
      sourceHintNone: "Requests bypass proxy",
      detectedProxy: "Detected proxy (read-only)",
      manualProxy: "Manual proxy (persisted)",
      effectiveProxy: "Effective proxy",
      source: "Source",
    },
    bastions: {
      title: "Bastions",
      name: "Name",
      host: "Host",
      port: "Port",
      username: "Username",
      password: "Password",
      pkeyPath: "Private key path",
      pkeyPassphrase: "Key passphrase",
    },
    mappings: {
      title: "Mappings",
      types: {
        tcp: "TCP",
        socks5: "SOCKS5",
        http: "HTTP",
        mixed: "Mixed (HTTP+SOCKS5)",
      },
      localHost: "Local host",
      localPort: "Local port",
      remoteHost: "Remote host",
      remotePort: "Remote port",
      id: "ID",
      type: "Type",
      local: "Local",
      remote: "Remote",
      chain: "Bastion chain",
      allowCidrs: "Allow CIDR",
      denyCidrs: "Deny CIDR",
      autoStart: "Auto-start",
      running: "Running",
      start: "Start",
      stop: "Stop",
      copyModify: "Copy modify",
      trafficChart: "Traffic chart",
      trafficUp: "Up",
      trafficDown: "Down",
      trafficConnections: "Connections",
    },
    httpLogs: {
      title: "HTTP Logs",
      columns: {
        mapping: "Mapping",
        port: "Port",
        method: "Method",
        status: "Status",
        host: "Host",
        url: "URL",
        duration: "ms",
      },
      q: "Keyword",
      request: "Request",
      response: "Response",
      pair: "Pair",
      headers: "Headers",
      body: "Body",
      decodeGzip: "Decode gzip (response body only)",
      truncated: "Truncated: {reason}",
    },
    errorLogs: {
      title: "Error Logs",
      level: "Level",
      source: "Source",
      message: "Message",
      detail: "Detail",
      stack: "Stack",
      context: "Context",
    },
    dialogs: {
      shutdownTitle: "Confirm shutdown",
      shutdownAlert: "This will stop the Bastion process. Please confirm.",
      updateTitle: "Confirm update",
      updateAlert: "This will download, replace the binary, and restart.",
      deleteTitle: "Confirm delete?",
    },
  },
};

export const i18n = createI18n({
  legacy: false,
  globalInjection: true,
  locale: "zh",
  fallbackLocale: "en",
  messages,
});

export function syncI18nWithStore() {
  const app = useAppStore();
  i18n.global.locale.value = app.language;

  app.$subscribe((_mutation, state) => {
    i18n.global.locale.value = state.language;
  });
}
